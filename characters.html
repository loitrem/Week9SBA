<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/6f83b941e3.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="style/style.css">
    <title>The Simpsons</title>
</head>
<body onload="">
  <div class="body_div">
  <div class="header_logo_container">
    <div class="header_logo">
        <img id="logo" src="https://upload.wikimedia.org/wikipedia/commons/b/b7/The_logo_simpsons_yellow.png" alt="">
      </div>
      <div style="padding-bottom: 10px;">
        <nav>
        <ul class="navbar menu">
        <li class="toggle"><a href="#"><i class="fas fa-bars"></i></a></li>
        <li class="item"><a href="index.html">Home</a></li>
        <li class="item"><a href="episodes.html">Epidode List</a></li>
        <li class="item has-submenu"><a href="characters.html" tabindex="0">Main Characters</a>
        </li>
        </ul>  
          </nav>
      </div> 
      <div id="letUsKnow" style="display: flex; justify-content: space-evenly; background-color: skyblue; border-radius: 25px; padding: 0.5em; border: 1px solid black; padding: 15px;">
          <form id="favorite" method="GET" action="characters.html">
              <table style="width: 50%;">
                  <tr>
                      <td style="font-weight: bold; justify-content: center;">Who is your Favorite Simpsons Character?</td>
                      <td><input id="fav_character" type="text" size="20"></td>
                      <td><input id="submit" type="submit" value="Tell Us" size="20"></td>
                  </tr>
              </table>
          </form>
          <div style="justify-content: flex-end;">
          <form method="GET" action="characters.html">
            <table id="selectTable">
                <tr>
                    <td style="font-weight: bold;">Select a Character to View</td>
                </tr>
                <tr>
                    <td><select id="characterSelect" onchange="getValue()">
                        <option value="homer">Homer</option>
                        <option value="marge">Marge</option>
                        <option value="bart">Bart</option>
                        <option value="lisa">Lisa</option>
                        <option value="maggie">Maggie</option>
                    </select></td>
                </tr>                
            </table>
        </form></div>
      </div>
  </div>
      
    
    <div id="container" class="container_characters" style="padding: 2em;">
        <div class=container_inside></div>
            
        
        
        <div class="char_display">
            <div><img id="char_image" src="" alt="" style="width: 200px;"></div>           
            <div id="char_name"></div>
            <div id="char_age"></div>
            <div id="char_occupation"></div>
            <div id="char_catchphrase"></div>
            <div id="char_hobbies"></div>
            <br>          
        </div>
  </div>

  <script>

    function getValue(){
        let selectedValue = document.getElementById("characterSelect").value;

        let getCharacter = new XMLHttpRequest();

        getCharacter.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                let parsedCharacter = JSON.parse(this.responseText); 
                document.getElementById("char_image").src = parsedCharacter[0].Image;
                document.getElementById("char_name").innerHTML = "Name: " + parsedCharacter[0].Name;
                document.getElementById("char_age").innerHTML = "Age: " + parsedCharacter[0].Age;
                document.getElementById("char_catchphrase").innerHTML = "Catchphrase: " + parsedCharacter[0].Catchphrase;
                document.getElementById("char_hobbies").innerHTML = "Hobbies: " + parsedCharacter[0].Hobbies;
                document.getElementById("char_occupation").innerHTML = "Occupation: " + parsedCharacter[0].Occupation;
                }
            };
            console.log(selectedValue);
            getCharacter.open("GET", "./files/"+selectedValue+".json", true);
            getCharacter.send();
        }

            let favCharacter = [];
            const addChar = (fav)=>{
                fav.preventDefault();// stop form from submitting

                let answer = document.getElementById('fav_character').value;
                console.log(answer);
                
                let re = new RegExp(/^[a-z][a-z\s]*$/);
                if(answer==""){
                    let message = "Answer can only be Letters. Cannot be empty.";
                    alert(message);
                }
                else if(!re.test(answer)){
                    let message = "Answer can only be Letters. you wrote: " + answer;
                    alert(message);
                }
                else{

                let input = {
                    id: Date.now(),
                    character: document.getElementById('fav_character').value
                }
                favCharacter.push(input); // add to array
                document.querySelector('form').reset(); // clear the form

                // save to local storage
                localStorage.setItem('DOMContentLoaded', JSON.stringify(favCharacter)); 
                alert('Your favorite ' + answer + ' has been saved!');
                   
            }
        }
        
        document.addEventListener('DOMContentLoaded', ()=>{
        document.getElementById('submit').addEventListener('click', addChar);
    });

</script>
  <script src="javascript/process.js"></script>
   </div> 
</body> 
</html>